<!doctype html>
<meta charset="utf-8">
<style>
* {
  margin: 0;
  padding: 0;
}

body {
  background: #fff;
}

section {
  border: 1px solid #eee;
  margin: 20px;
  display: inline-block;
}

path, line {
  fill: none;
}

.line {
  stroke: #ccf;
  stroke-width: 1px;
}

.axis path,
.axis line,
.axis text {
  display: none;
}

.tick line {
  display: block;
  fill: none;
  stroke: rgba(0, 0, 0, .05);
  shape-rendering: crispEdges;
}

</style>
<section></section>
<script src="http://d3js.org/d3.v3.js"></script>
<script>
function getRandomArbitary (min, max) {
  return Math.random() * (max - min) + min;
}

data = []
// { "Timestamp": TIMESTAMP-ISO8601, "Value": INT }

time = new Date
time.setSeconds(time.getSeconds() - 60)

for(var i=0; i<60; i++) {
  time.setSeconds(time.getSeconds() + 1)
  data.push({
    "Timestamp": time.toISOString(),
    "Value": getRandomArbitary(10, 20)
  })
}

width = 800
height = 200
margin = 20

parseDate = d3.time.format.iso.parse

for(var i=0; i<data.length; i++) {
  data[i].Timestamp = parseDate(data[i].Timestamp)
}

x = d3.time.scale().range([0, width])
y = d3.scale.linear().range([height + margin, margin])

stack = d3.layout.stack().offset("wiggle")

line = d3.svg.line()
  .x(function(d) { return x(d.Timestamp) })
  .y(function(d) { return y(d.Value) })
  .interpolate("cardinal")

svg = d3.select("section").append("svg")
  .attr("width", width)
  .attr("height", height + margin)

axis = d3.svg.axis()
  .scale(x)
  .orient("bottom")
  .ticks(data.length / 3)
  .tickSize(-height, 0, 0)
  .tickFormat("")

x.domain(d3.extent(data, function(d) { return d.Timestamp }))
y.domain([0, 20])

svg.append("path")
  .datum(data)
  .attr("class", "line")
  .attr("d", line)

svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(axis)

function animate() {
  x.domain(d3.extent(data, function(d) { return d.Timestamp }))

  d3.select("path").transition()
    .duration(0)
    .attr("d", line)

  data.shift()
  data.push({
    "Timestamp": (new Date),
    "Value": getRandomArbitary(10, 20)
  })

  console.debug({ size: data.length, last: data[data.length - 1] })
  setTimeout(animate, 1000)
}

animate()
</script>
