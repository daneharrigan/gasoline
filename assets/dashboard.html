<!doctype html>
<link rel="stylesheet" type="text/css" href="/assets/gasoline.css">
<script src="/assets/d3.v3.min.js"></script>
<script src="/assets/gasoline.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function(){
	Gasoline.DB.Lines = []

	Gasoline.DB.PageViews = Gasoline.format.number(0)
	Gasoline.DB.UniqueVisitors = Gasoline.format.number(0)
	Gasoline.DB.ReturningVisitors = Gasoline.format.number(0)
	Gasoline.DB.Visits = Gasoline.format.number(0)

	new Gasoline.Value("#page-views",{ value: Gasoline.DB.PageViews, update: true })
	new Gasoline.Value("#unique-visitors", { value: Gasoline.DB.UniqueVisitors, update: true })
	new Gasoline.Value("#returning-visitors", { value: Gasoline.DB.ReturningVisitors, update: true })
	new Gasoline.Value("#visits", { value: Gasoline.DB.Visits, update: true })

	var
	c = document.querySelector("#content"),
	l = document.querySelector("#left"),
	width = (c.offsetWidth - l.offsetWidth) - 140

	new Gasoline.Graph("section#live", {
		width: width,
		height: 100,
		margin: 15,
		name: "traffic",
		data: Gasoline.DB.Lines,
		update: true
	})

	var source = new EventSource("/stream?i=ebe7b2084a8d0cb0")

	source.addEventListener("update", handleSteam, false)
	//source.addEventListener("error", handleError)

	function handleSteam(event) {
		var data = JSON.parse(event.data)
		for(var k in data) {
			console.debug(data)
			var value = data[k]
			switch(k) {
			case "PageView":
				Gasoline.DB.PageViews = Gasoline.format.number(value)
				break
			case "Visit":
				Gasoline.DB.Visits = Gasoline.format.number(value)
				break
			case "UniqueVisitor":
				Gasoline.DB.UniqueVisitors = Gasoline.format.number(value)
				break
			case "ReturnVisitor":
				Gasoline.DB.ReturnVisitors = Gasoline.format.number(value)
				break
			case "TopView":
				/*
				for(var i=0; value.length > i; i++) {
					var v = value[i].Value.split("|"),
					    t = v.shift() + "\n"
					value[i].Value = t + v.join("|")
				}
				updateList("#top-view", value)
				*/
				break
			case "Features":
				//updateList("#features", value)
				break
			case "Resolutions":
				//updateList("#resolutions", value)
				break
			case "OS":
				//updateList("#os", value)
				break
			case "BrowserUsage":
				/*
				for(var k in value) {
					updateList("#browser-" + k, value[k])
				}
				*/
			}
		}
	}
})
</script>
<header>
	<hgroup>
		<h1>gasoline</h1>
		<h2>dane.heroku.com</h2>
	</hgroup>
</header>
<section id="content">
	<aside id="left">
		<ul>
			<li>
				<h3>Page Views</h3>
				<span id="page-views">1,000,000</span>
			</li>
			<li>
				<h3>Unique Visitors</h3>
				<span id="unique-visitors">150,000</span>
			</li>
			<li>
				<h3>Returning Visitors</h3>
				<span id="returning-visitors">850,000</span>
			</li>
			<li>
				<h3>Visits</h3>
				<span id="visits">980,000</span>
			</li>
			<li id="frequented-pages">
				<h3>Frequented Pages</h3>
				<ol>
					<li>
						<p>home page title | dane.heroku.com</p>
						<p>/</p>
						<span>50,000</span>
					</li>
					<li>
						<p>foo bar baz article | dane.heroku.com</p>
						<p>/blog/foo-bar-baz</p>
						<span>10,000</span>
					</li>
					<li>
						<p>contact | dane.heroku.com</p>
						<p>/contact</p>
						<span>5,000</span>
					</li>
				<ol>
			</li>
		</ul>
	</aside>
	<section id="live"></section>
	<hr>
</section>
<!-- <footer>footer</footer> -->
<!--
<ul>
	<li id="page-view">
		<strong>Page Views:</strong>
		<span class="value"></span>
	</li>

	<li id="visit">
		<strong>Visits:</strong>
		<span class="value"></span>
	</li>

	<li id="unique-visitor">
		<strong>Unique Visitors:</strong>
		<span class="value"></span>
	</li>

	<li id="return-visitor">
		<strong>Returning Visitors:</strong>
		<span class="value"></span>
	</li>
</ul>

<hr>

<ul id="top-view"></ul>

<hr>

<ul id="features"></ul>

<hr>

<ul id="resolutions"></ul>

<hr>

<ul id="os"></ul>

<hr>

<dl>
	<dt>Chrome</dt>
	<dd><ul id="browser-Chrome"></ul></dd>
	<dt>Safari</dt>
	<dd><ul id="browser-Safari"></ul></dd>
	<dt>Firefox</dt>
	<dd><ul id="browser-Firefox"></ul></dd>
	<dt>MSIE</dt>
	<dd><ul id="browser-MSIE"></ul></dd>
</dl>
-->
