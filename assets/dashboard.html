<!doctype html>
<style type="text/css">
body {
	font: 14px "Helvetica Neue", Helvetica, sans-serif;
	color: #666;
}

.label {
	font-weight: bold;
	margin-right: 5px;
}
</style>
<script>
document.addEventListener("DOMContentLoaded", function(){
	var source = new EventSource("/stream?i=ebe7b2084a8d0cb0")

	source.addEventListener("update", handleSteam, false)
	source.addEventListener("error", handleError)

	function handleSteam(event) {
		var data = JSON.parse(event.data)
		for(var k in data) {
			var value = data[k]
			switch(k) {
			case "PageView":
				updateElement("#page-view .value", value)
				break
			case "Visit":
				updateElement("#visit .value", value)
				break
			case "UniqueVisitor":
				updateElement("#unique-visitor .value", value)
				break
			case "ReturnVisitor":
				updateElement("#return-visitor .value", value)
				break
			case "TopView":
				updateList("#top-view", value)
				break
			case "Features":
				updateList("#features", value)
				break
			case "Resolutions":
				updateList("#resolutions", value)
				break
			case "OS":
				updateList("#os", value)
				break
			case "BrowserUsage":
				for(var k in value) {
					updateList("#browser-" + k, value[k])
				}
			}
		}
	}

	function handleError() {
		source.close()
	}

	function updateElement(selector, value) {
		document.querySelector(selector).innerText = value
	}

	function updateList(selector, list) {
		if(!list) {
			return
		}

		var el = document.querySelector(selector),
				li = el.querySelectorAll("li")

		for(var i=0; i<list.length; i++) {
			var value = list[i].Value,
					count = list[i].Count,
					v, c

			if(li[i]) {
				v = li[i].querySelector(".label")
				c = li[i].querySelector(".value")
			} else {
				var l = document.createElement("li")
						v = document.createElement("span"),
						c = document.createElement("span")

				v.setAttribute("class", "label")
				c.setAttribute("class", "value")

				l.appendChild(v)
				l.appendChild(c)
				el.appendChild(l)
			}

			if(v.innerText != value) {
				v.innerText = value
			}

			c.innerText = count
		}
	}
})
</script>

<ul>
	<li id="page-view">
		<strong>Page Views:</strong>
		<span class="value"></span>
	</li>

	<li id="visit">
		<strong>Visits:</strong>
		<span class="value"></span>
	</li>

	<li id="unique-visitor">
		<strong>Unique Visitors:</strong>
		<span class="value"></span>
	</li>

	<li id="return-visitor">
		<strong>Returning Visitors:</strong>
		<span class="value"></span>
	</li>
</ul>

<hr>

<ul id="top-view"></ul>

<hr>

<ul id="features"></ul>

<hr>

<ul id="resolutions"></ul>

<hr>

<ul id="os"></ul>

<hr>

<dl>
	<dt>Chrome</dt>
	<dd><ul id="browser-Chrome"></ul></dd>
	<dt>Safari</dt>
	<dd><ul id="browser-Safari"></ul></dd>
	<dt>Firefox</dt>
	<dd><ul id="browser-Firefox"></ul></dd>
	<dt>MSIE</dt>
	<dd><ul id="browser-MSIE"></ul></dd>
</dl>
